#!/usr/bin/perl
use strict;
use warnings FATAL => 'all';

my $command = shift;

open(my $fh, '<', "$ENV{HOME}/.ssh/config") or die $!;
my @hosts;
while(my $l = <$fh>) {
  next if $l =~ /^#/;
  push(@hosts, $1) if $l =~ m/^[Hh]ost\s+(\w+)/;
}

my $i = 35;
for my $h(@hosts) {
  printf("\e[48;5;%d;1;38;5;232m%s\e[m:\n", $i, $h);
  system('ssh', $h, $command);
  $i += 30;
}
